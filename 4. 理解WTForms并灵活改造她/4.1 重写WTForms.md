# 4.1 重写WTForms

之前的代码，修改完成之后，已经修复了之前的缺陷，但是这样爆出了两个问题：
1.代码太啰嗦了，每个试图函数里，都需要这么写
2.ClientTypeError只是代表客户端类型异常，其他的参数校验不通过也抛出这个异常的话不合适

为了解决上面的问题，我们需要重写wtforms

定义一个自定义BaseForm，让其他的Form来继承

```python

class BaseForm(Form):
    def __init__(self, data):
        super(BaseForm, self).__init__(data=data)

    def validate_for_api(self):
        valid = super(BaseForm, self).validate()
        if not valid:
            raise ParameterException(msg=self.errors)
```

以后我们的试图函数就可以这样编写
```python
@api.route('/register', methods=['POST'])
def create_client():
    data = request.json
    form = ClientForm(data=data)

    form.validate_for_api()
    promise = {
        ClientTypeEnum.USER_EMAIL: __register_user_by_email
    }
    promise[form.type.data]()

    return 'success'
```